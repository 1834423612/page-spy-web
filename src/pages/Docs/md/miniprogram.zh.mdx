import { CodeBlock } from '@/components/CodeBlock'
import MPWarning from '@/components/MPWarning'
import { Link } from 'react-router-dom'
import { Tooltip } from 'antd'

<MPWarning style={{ marginBottom: 12, borderRadius: 8, color: '#888' }} inline />

第一步，在项目中安装依赖。我们提供了几种小程序平台的 SDK，请根据需要安装：

<CodeBlock dynamicCode={({ t }) => `# ${t('common.mpwechat')}
yarn add @huolala-tech/page-spy-wechat@latest

# ${t('common.mpalipay')}
yarn add @huolala-tech/page-spy-alipay@latest

# UniAPP
yarn add @huolala-tech/page-spy-uniapp@latest

# Taro
yarn add @huolala-tech/page-spy-taro@latest
`} lang="bash" />

第二步，将 PageSpy 服务域名填入小程序的 http、websocket 请求白名单中。注意除了开发环境，小程序强制要求使用 https 和 wss 协议：

<CodeBlock code={`https://localhost:5173
wss://localhost:5173`} />

第三步，在入口文件中引入 SDK 并实例化，初始化参数提供了可选的 <a href={import.meta.env.VITE_SDK_WECHAT_REPO}>配置项</a> 用于自定义 SDK 的行为：

<CodeBlock dynamicCode={({ deployPath }) => `import PageSpy from '@huolala-tech/page-spy-wechat';

new PageSpy({
  api: "${deployPath}",
})`} lang='js' />

以上就是在小程序项目中接入 PageSpy 的全部流程，接入完成后点击顶部菜单 <Tooltip title="菜单默认隐藏，部署后可见" color="purple"><a href="javascript:void(0)">开始调试</a></Tooltip> 使用！
